---
title: "CA 4: Part A - Database Design & SQL Querying"
author: "Gareth Burger"
date: "January, 2023"
output:
  pdf_document: default
  html_document:
    code_folding: show
subtitle: R and SQL code to generate and populate a SQLite database
---

```{r Setup and Library Load, include=FALSE}
# clear console on each execute and set chunk default to not show code
cat('\014')

# download and load libraries
if(!require("RSQLite"))
  install.packages("RSQLite")

library(RSQLite)

# delete db file on first run before creating tables
if(file.exists("daie_ca4_data.sqlite"))
  file.remove("daie_ca4_data.sqlite")
```

---

## E-R Diagram

The E-R diagram of the logical data model describing the structure of my database.

![](ER_diagram.png)

---

## Generate and Connect to SQLite Database
```{r Create DB}
# connect to a new local SQLite database (and create if doesn't yet exist)
conn <- dbConnect(RSQLite::SQLite(), dbname = "daie_ca4_data.sqlite")
```

---

## Create Tables in Database
```{r Create Tables}
# create the tables using the SQL from the script generated by Vertabelo
# -- Table: asset
dbExecute(conn, "CREATE TABLE asset (
    id int NOT NULL CONSTRAINT asset_pk PRIMARY KEY,
    asset_description varchar(128) NOT NULL,
    asset_type varchar(128) NOT NULL,
    project_id int NOT NULL)")

# -- Table: asset_library_mapping
dbExecute(conn, "CREATE TABLE asset_library_mapping (
    asset_id int NOT NULL,
    library_id int NOT NULL)")

# -- Table: library
dbExecute(conn, "CREATE TABLE library (
    id int NOT NULL CONSTRAINT library_pk PRIMARY KEY,
    library_name varchar(128) NOT NULL)")

# -- Table: project
dbExecute(conn, "CREATE TABLE project (
    id int NOT NULL CONSTRAINT project_pk PRIMARY KEY,
    project_name varchar(128) NOT NULL,
    delivery_date date NOT NULL,
    team_id int NOT NULL)")

# -- Table: role
dbExecute(conn, "CREATE TABLE role (
    id int NOT NULL CONSTRAINT role_pk PRIMARY KEY,
    role_name varchar(128) NOT NULL)")

# -- Table: team
dbExecute(conn, "CREATE TABLE team (
    id int NOT NULL CONSTRAINT team_pk PRIMARY KEY,
    team_name varchar(128) NOT NULL)")

# -- Table: team_member
dbExecute(conn, "CREATE TABLE team_member (
    id int NOT NULL CONSTRAINT team_member_pk PRIMARY KEY,
    first_name varchar(64) NOT NULL,
    last_name varchar(64) NOT NULL,
    role_id int NOT NULL,
    team_id int NOT NULL)")

# -- Table: work_item
dbExecute(conn, "CREATE TABLE work_item (
    id int NOT NULL CONSTRAINT work_item_pk PRIMARY KEY,
    work_item_description text NOT NULL,
    work_item_status varchar(64) NOT NULL,
    asset_id int NOT NULL,
    team_member_id int NOT NULL)")
```

---

## Populate Tables with Data
```{r Insert Data}
# populate the SQLite database with data

# populate the asset table
dbExecute(conn, "INSERT INTO asset
          VALUES (1, 'Medieval Knight', '3D Character', 2)")
dbExecute(conn, "INSERT INTO asset
          VALUES (2, 'Horse', '3D Character', 2)")
dbExecute(conn, "INSERT INTO asset
          VALUES (3, 'Wooden Table', '3D Object', 2)")
dbExecute(conn, "INSERT INTO asset
          VALUES (4, 'Spaceship', '3D Object', 1)")
dbExecute(conn, "INSERT INTO asset
          VALUES (5, 'Milky Way', 'Environment', 1)")

# populate the asset_library_mapping table
dbExecute(conn, "INSERT INTO asset_library_mapping
          VALUES (1, 2)")
dbExecute(conn, "INSERT INTO asset_library_mapping
          VALUES (2, 2)")
dbExecute(conn, "INSERT INTO asset_library_mapping
          VALUES (3, 3)")
dbExecute(conn, "INSERT INTO asset_library_mapping
          VALUES (4, 3)")
dbExecute(conn, "INSERT INTO asset_library_mapping
          VALUES (5, 1)")
dbExecute(conn, "INSERT INTO asset_library_mapping
          VALUES (1, 4)")
dbExecute(conn, "INSERT INTO asset_library_mapping
          VALUES (2, 4)")
dbExecute(conn, "INSERT INTO asset_library_mapping
          VALUES (3, 4)")
dbExecute(conn, "INSERT INTO asset_library_mapping
          VALUES (4, 5)")
dbExecute(conn, "INSERT INTO asset_library_mapping
          VALUES (5, 5)")

# populate the library table
dbExecute(conn, "INSERT INTO library
          VALUES (1, 'Environments')")
dbExecute(conn, "INSERT INTO library
          VALUES (2, '3D Characters')")
dbExecute(conn, "INSERT INTO library
          VALUES (3, '3D Objects')")
dbExecute(conn, "INSERT INTO library
          VALUES (4, 'Medieval Pack')")
dbExecute(conn, "INSERT INTO library
          VALUES (5, 'Space Pack')")

# populate the project table
dbExecute(conn, "INSERT INTO project
          VALUES (1, 'Game 1', '2023-06-23', 1)")
dbExecute(conn, "INSERT INTO project
          VALUES (2, 'Game 2', '2023-12-12', 2)")

# populate the role table
dbExecute(conn, "INSERT INTO role
          VALUES (1, 'Team Lead')")
dbExecute(conn, "INSERT INTO role
          VALUES (2, 'Programmer')")
dbExecute(conn, "INSERT INTO role
          VALUES (3, 'Tester')")
dbExecute(conn, "INSERT INTO role
          VALUES (4, 'Artist')")
dbExecute(conn, "INSERT INTO role
          VALUES (5, '3D Modeller')")

# populate the team table
dbExecute(conn, "INSERT INTO team
          VALUES (1, 'Team 1')")
dbExecute(conn, "INSERT INTO team
          VALUES (2, 'Team 2')")

# populate the team_member table
dbExecute(conn, "INSERT INTO team_member
          VALUES (1, 'Lillian', 'Griffin', 1, 1)")
dbExecute(conn, "INSERT INTO team_member
          VALUES (2, 'Alexandra', 'Foley', 1, 2)")
dbExecute(conn, "INSERT INTO team_member
          VALUES (3, 'Sumaiya', 'Kelley', 2, 1)")
dbExecute(conn, "INSERT INTO team_member
          VALUES (4, 'Alivia', 'Cannon', 2, 2)")
dbExecute(conn, "INSERT INTO team_member
          VALUES (5, 'Hafsa', 'Howard', 3, 1)")
dbExecute(conn, "INSERT INTO team_member
          VALUES (6, 'Tyrell', 'Hendrix', 3, 2)")
dbExecute(conn, "INSERT INTO team_member
          VALUES (7, 'Lena', 'Ruiz', 4, 1)")
dbExecute(conn, "INSERT INTO team_member
          VALUES (8, 'Annabelle', 'Hood', 4, 2)")
dbExecute(conn, "INSERT INTO team_member
          VALUES (9, 'Jago', 'Potts', 5, 1)")
dbExecute(conn, "INSERT INTO team_member
          VALUES (10, 'Oliwier', 'Brooks', 5, 2)")

# populate the work_item table
dbExecute(conn, "INSERT INTO work_item
          VALUES (1, 'Create a model of a wooden table', 'To Do', 1, 9)")
dbExecute(conn, "INSERT INTO work_item
          VALUES (2, 'Create a model of a spaceship', 'In Progress', 3, 10)")
dbExecute(conn, "INSERT INTO work_item
          VALUES (3, 'Test the animation of horse character', 'Complete', 2, 5)")
```

---

## Close Database Connection
```{r Disconnect}
# close the connection to the database to avoid hitting a connection limit
dbDisconnect(conn)
```